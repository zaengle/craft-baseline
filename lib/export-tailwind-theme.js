/**
 * Export selected parts of the Tailwind theme to PHP via JSON
 * @see package.json scripts for usage
 */
import fs from 'node:fs'
import path from 'node:path'
import resolveConfig from 'tailwindcss/resolveConfig'
import tailwindConfig from '../tailwind.config.mjs'

export default function generateTailwindConfig() {
  const { theme } = resolveConfig(tailwindConfig)

  const {
    colors,
    screens,
    fontFamily,
    fontSize,
  } = theme

// We don't want to export the entire theme, just the parts we need
  const exportedTheme = {
    colors,
    screens,
    fontFamily,
    fontSize,
  }

// This is safer than building a PHP array as a string, and both easier to read and
// nearly as fast on execution as to not be worth worrying about
  const phpStr = `<?php
  /** Do not edit this file directly. It is generated by the front end build process.
   To manually regenerate it do \`npm run tailwind:php\` */
  return json_decode('${JSON.stringify(exportedTheme, null, 2)}', true)
`
  try {
    // write the file to Craft's config directory
    fs.writeFileSync(
      path.resolve(process.cwd(), './src/config/zaengle/tailwind.php'),
      phpStr,
      'utf-8'
    )
  } catch (err) {
    // uh-oh, something happened here!
    console.error(err.message)
  }
}
